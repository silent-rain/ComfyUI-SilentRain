# 训练数据集处理

## 数据集收集

注意每个概念充满整个图片。

- 背景
- 人像
- 服装
- 配饰

## 数据集参数

数据集合数量：

- 50-200
- 10-16

分辨率：

- 一般支持自动分桶，但分桶过多会造成显存损耗
- 推荐: 768-1024
- 最低分辨率384-512

## 数据集清洗

- 命名格式: 统一命名格式
- 图片扩展名: 统一图片扩展名
- 图片分辨率: 统一分辨率
- 重复图片: 重复图片剔除
- alpha通道: 移除alpha通道, 添加白底
  - 训练器一般不支持Alpha通道的, 会造成一些稀奇古怪的问题，例如噪点、模糊等；
- 水印清理：
  - 清理图片中水印；
  - 移除图片中logo等不需要的元素
- 低质量图片: 剔除低质量图片

## 图片标注

格式: 触发词+主标签+次级标签
示例: 1girl, 宫崎骏风格, clip 反推提示词

风格迁移骚操作：
当图片中有无法表达的画风可以直接给一个特殊提示词让AI自行总结，以达到风格迁移的效果。

## Lora

小型的微调模型，适用于单一的概念：

- 一个人物
- 一个场景
- 一些风格特征

## 训练参数

- 训练批次
  - 批次太大，显存占用就多
  - 批次太小，耗时较长，但可能无法覆盖更多特征，导致风格混乱或泛化差；
- 学习率：
  - 1e-5 - 1e-4  - 非微调
  - 5e-5 - 5e-4   - 小规模微调
  - 1e-4 - 1e-3   - 大规模微调
  - 5e-4 - 5e-3   - 集成学习
  - 5e-3 - 5e-2   - 自监督学习
  - 5e-2 - 5e-1   - 图片生成
  - 1e-1 - 1e0     - 多模型集成
  - 5e-1 - 5e0     - 数据蒸馏
  - 5e0 - 1e1      - 多个风格迁移
  - 5e1 - 5e2      - 颜色迁移
- dim, alpha
  - dim=128, alpha=64
    - dim=128：越大捕获的细节越多
    - alpha=64：权重较高时会导致对参数敏感，容易过拟合，泛化能力差
  - dim=64, alpha=32
    - 平衡效果，推荐
  - dim=32, alpha=8
    - 捕获细节少，不容易过拟合
  - 总结：
    - dim=128, alpha=64: 可以快速收敛，但容易过拟合；
    - dim=64, alpha=32: 训练速度与泛化能力之间平衡
    - dim=32, alpha=8: 泛化能力强，对细节敏感程度低
